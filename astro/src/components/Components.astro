---
import type { ComponentProps } from "astro/types";
import HeaderSection, { HeaderSection_Query } from "@/components/global/HeaderSection.astro";
import ContactForm, { ContactForm_Query } from "@/components/global/ContactForm.astro";
import QuoteCards, { QuoteCards_Query } from "@/components/global/QuoteCards.astro";

export type ComponentsProps = ComponentProps<typeof HeaderSection> & { _type: string; index: number }[];

type Props = {
  data: ComponentsProps;
};

const { data } = Astro.props;

const components = {
  HeaderSection,
  ContactForm,
  QuoteCards,
};

export const Components_Query = /* groq */ `
  components[] {
    _type,
    _type == "HeaderSection" => {
      ${HeaderSection_Query}
    },
    _type == "ContactForm" => {
      ${ContactForm_Query}
    },
    _type == "QuoteCards" => {
      ${QuoteCards_Query}
    },
  },
`;
---

{
  data.map((item, i) => {
    const DynamicComponent = components[item._type];
    if (!DynamicComponent) return null;
    return <DynamicComponent {...item} index={i} />;
  })
}
